options("scipen"= 200, "digits"=3, width = 100)
options("scipen"= 200, "digits"=3, width = 100)
rm(list=ls())
row_names<-c("AS", "JR", "surprise")
col_names<-c("PW", "TR", "EB", "T2", "P")
item <- matrix(c(0,1,0,1,1,
1,0,1,0,0,
.1,.4,.1,0,.1), byrow = TRUE, nrow = 3, ncol = 5, dimnames=list(row_names,col_names))
item
rating <-matrix(c(3,1,5,2,4),nrow=1,ncol=5)
rating_m <-rating-mean(rating)
rating_m
# t() means taking the transpose of a matrix, M'
user<-item %*% t(rating_m) / rowSums(item)
user
t(rating_m)
rowSums(item)
# t() means taking the transpose of a matrix, M'
user<-item %*% t(rating_m) / rowSums(item)
rowSums(item)
user
row_names<-c("AS", "JR", "surprise")
col_names<-c("TL", "NH")
new_item <- matrix(c(1,0,
0,1,
.1,0), byrow = TRUE, nrow = 3, ncol = 2, dimnames=list(row_names,col_names))
new_item
CS = t(new_item) %*% user / (sqrt(colSums(new_item^2))*sqrt(sum(user^2)))
CS
row_names<-c("Funny", "Romant", "Suspense", "Dark")
col_names<-c("Sharp Obj", "Arrested Dev", "Arbitrage", "Margin C", "Bojack", "Orphan B", "Hinterland")
item <- matrix(c(0,1,0,1,1,1,0,
1,1,0,0,1,0,0,
1,1,1,0,1,0,1,
1,0,1,1,0,1,1),
byrow = TRUE, nrow = 4, ncol = 7, dimnames=list(row_names,col_names))
item
rating <-matrix(c(4,3,4,5,3),nrow=1,ncol=5)
row_names<-c("A", "B", "C", "D", "E", "F", "G")
col_names<-c("PW", "TR", "EB", "T2", "P", "NH")
util <- matrix(c(2,5,4,2,NA, NA,
5,1,2,NA,1,NA,
5,5,5,5,5,5,
2,5,NA,3,NA,NA,
5,4,5,3,NA,5,
1,5,NA,NA,NA,1,
2,NA,5,NA,5,NA),byrow = TRUE, nrow = 7, ncol = 6, dimnames=list(row_names,col_names))
util
m<-cor(t(util), use="pairwise.complete.obs")
m[row=c("B","F","G"),col=c("A")]
m<-cor(t(util), use="pairwise.complete.obs")
m
m[row=c("B","F","G"),col=c("A")]
util_n <-util-rowMeans(util, na.rm=TRUE)
predm<-m[row=c("B","F","G"),col=c("A")]*util_n[row=c("B","F","G"),col=c("P","NH")]
pred<-colMeans(predm, na.rm=TRUE)
pred
cor(util, use="pairwise.complete.obs")
m<-cor(util, use="pairwise.complete.obs")
m
m<-m[row=c("PW", "TR","EB"), col=c("P", "NH")]
# make NA anything less than 1
m[abs(m)<1]<-NA
m
predm<-m*util_n[row=c("A"),col=c("PW", "TR","EB")]
predm
pred<-colMeans(predm, na.rm = TRUE)
pred
row_names<-c("George", "Adam", "Ben", "Cam", "Dan")
col_names<-c("Sharp Obj", "Arrested Dev", "Arbitrage", "Margin C", "Bojack", "Orphan B", "Hinterland")
util <- matrix(c(4,3,4,5,3,NA,NA,
4,3,4,4,3,NA,NA,
3,4,3,1,3,5,NA,
4,4,4,4,4,2,4,
2,1,2,3,1,NA,3),byrow = TRUE, nrow = 5, ncol = 7, dimnames=list(row_names,col_names))
util
library(dplyr)
library(tidyverse)
library(R.utils)
library(data.table)
#read similar files
rm(list=ls())
memory.limit()
memory.limit(size=1000000)
memory.limit()
similar_map <- read.csv("../Datasets/similar_map_thesis.csv")
setwd("C:/Users/verbr/Documents/Masterscriptie/Goodreads/Join files")
similar_map <- read.csv("../Datasets/similar_map_thesis.csv")
#delete more than 1 similar books in similar map file
similar_map <-similar_map[!duplicated(similar_map$focal_book_id), ]
similar_review <- fread("../Datasets/similar_rev_thesis.gz")
#size down similar_review file!!
similar_review <- similar_review %>% filter(similar_book_id %in% similar_map$similar_book_id)
str(similar_review$similar_book_id)
str(similar_map$similar_book_id)
max(similar_review$similar_book_id)
#size down similar_review file!!
similar_review <- similar_review %>% filter(similar_book_id %in% similar_map$similar_book_id)
fwrite(similar_review, "../Datasets/similar_review.csv")
#read similar files
rm(list=ls())
memory.limit()
memory.limit(size=1000000)
memory.limit()
similar_review <- read.csv("../Datasets/similar_review.csv")
similar_map <- read.csv("../Datasets/similar_map_thesis.csv")
similar_meta <- read.csv("../Datasets/similar_meta_thesis.csv")
#delete more than 1 similar books in similar map file
similar_map <-similar_map[!duplicated(similar_map$focal_book_id), ]
#join similar_map and similar_meta
similar <- similar_map %>% inner_join(similar_meta, by="similar_book_id")
#delete variables not used in further analysis
similar <- similar %>% select(focal_book_id, similar_book_id, title=title.x, reviews, rating, average.rating, publication_date)
similar$treated <- "0"
book_info <- read.csv("../Datasets/book_df_cleanPublisher.csv")
book$treated <- "1"
#create subset of book_info data set
book <- book_info %>% select(focal_book_id=id, title, reviews=text_reviews_count, rating=ratings_count, average.rating=average_rating, publication_date=book_publication_date)
book$treated <- "1"
names(book)
names(similar)
#read similar files
rm(list=ls())
similar_map <- read.csv("../Datasets/similar_map_thesis.csv")
similar_meta <- read.csv("../Datasets/similar_meta_thesis.csv")
#delete more than 1 similar books in similar map file
similar_map <-similar_map[!duplicated(similar_map$focal_book_id), ]
#join similar_map and similar_meta
similar <- similar_map %>% inner_join(similar_meta, by="similar_book_id")
rm(similar_map)
rm(similar_meta)
similar <- similar %>% distinct()
#delete variables not used in further analysis
similar <- similar %>% select(focal_book_id, similar_book_id, title=title.x, reviews, rating, average.rating, publication_date)
similar$treated <- "0"
#create subset of book_info data set
book <- book_info %>% select(focal_book_id=id, title, reviews=text_reviews_count, rating=ratings_count, average.rating=average_rating, publication_date=book_publication_date)
book_info <- read.csv("../Datasets/book_df_cleanPublisher.csv")
#create subset of book_info data set
book <- book_info %>% select(focal_book_id=id, title, reviews=text_reviews_count, rating=ratings_count, average.rating=average_rating, publication_date=book_publication_date)
book$treated <- "1"
rm(book_info)
View(similar)
similar_append <- similar %>% select(focal_book_id, similar_book_id)
#filter books data set for whether books appear in similar data set
book <- book %>% filter(focal_book_id %in% similar$focal_book_id)
#only select focal book id and similar book id to append to book set
similar_append <- similar %>% select(focal_book_id, similar_book_id)
#join similar_book_id to book set
book_complete <- similar_append %>% right_join(book, by="focal_book_id")
View(book_complete)
#join data sets!
est_3 <- rbind(book_complete,similar)
View(est_3)
rm(book)
rm(book_complete)
rm(similar)
rm(similar_append)
#read review data for similar books
similar_review <- read.csv("../Datasets/similar_review.csv")
#append ratings to existing dataset
View(est_3)
similar_ratings <- est_3 %>% left_join(similar_review, by="similar_book_id")
rm(similar_review)
